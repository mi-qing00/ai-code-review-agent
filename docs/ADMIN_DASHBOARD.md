# Admin Dashboard ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

ç®¡ç†ä»ªè¡¨æ¿æä¾›äº†å¯è§†åŒ–çš„é˜Ÿåˆ—å’Œä½œä¸šç®¡ç†ç•Œé¢ï¼Œæ–¹ä¾¿ç›‘æ§å’Œç®¡ç†ä»£ç å®¡æŸ¥ç³»ç»Ÿã€‚

## è®¿é—®ä»ªè¡¨æ¿

å¯åŠ¨åº”ç”¨åï¼Œè®¿é—®ï¼š
```
http://localhost:8000/api/admin/dashboard
```

## åŠŸèƒ½ç‰¹æ€§

### 1. å®æ—¶ç»Ÿè®¡é¢æ¿

ä»ªè¡¨æ¿é¡¶éƒ¨æ˜¾ç¤ºå…³é”®æŒ‡æ ‡ï¼š
- **Total PRs**: å¤„ç†çš„ PR æ€»æ•°
- **Queued**: ç­‰å¾…å¤„ç†çš„ä½œä¸šæ•°
- **Processing**: æ­£åœ¨å¤„ç†çš„ä½œä¸šæ•°
- **Completed**: å·²å®Œæˆçš„ä½œä¸šæ•°
- **Failed**: å¤±è´¥çš„ä½œä¸šæ•°
- **Queue Length**: Redis é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯æ•°

### 2. ä½œä¸šåˆ—è¡¨

æ˜¾ç¤ºæœ€è¿‘çš„ä½œä¸šï¼ŒåŒ…å«ï¼š
- PR ç¼–å·å’Œä»“åº“åç§°
- ä½œä¸šçŠ¶æ€ï¼ˆå¸¦é¢œè‰²æ ‡è®°ï¼‰
- Job ID
- æ—¶é—´æˆ³ï¼ˆå…¥é˜Ÿã€å¼€å§‹ã€å®Œæˆï¼‰
- æ“ä½œæŒ‰é’®ï¼ˆæŸ¥çœ‹ã€é‡è¯•ï¼‰

### 3. è‡ªåŠ¨åˆ·æ–°

ä»ªè¡¨æ¿æ¯ 10 ç§’è‡ªåŠ¨åˆ·æ–°ï¼Œä¿æŒæ•°æ®æœ€æ–°ã€‚

## API ç«¯ç‚¹

### ç®¡ç†ç«¯ç‚¹

#### 1. è·å–ç»Ÿè®¡ä¿¡æ¯
```bash
GET /api/admin/stats
```

è¿”å›ï¼š
```json
{
  "queue": {
    "stream_length": 5,
    "pending_messages": 0,
    "consumer_groups": 1
  },
  "database": {
    "total_prs": 100,
    "queued": 2,
    "processing": 1,
    "completed": 95,
    "failed": 1,
    "dead_letter": 1,
    "avg_processing_time_seconds": 2.5,
    "last_completed_at": "2025-11-04T00:30:00Z"
  },
  "recent_activity": {
    "prs_last_hour": 10,
    "completed_last_hour": 8
  }
}
```

#### 2. åˆ—å‡ºä½œä¸š
```bash
GET /api/admin/jobs?status=queued&limit=50&offset=0
```

å‚æ•°ï¼š
- `status` (å¯é€‰): è¿‡æ»¤çŠ¶æ€ (queued, processing, completed, failed, dead_letter)
- `limit` (é»˜è®¤ 50): è¿”å›æ•°é‡ (1-1000)
- `offset` (é»˜è®¤ 0): åç§»é‡

#### 3. è·å–ä½œä¸šè¯¦æƒ…
```bash
GET /api/admin/jobs/{job_id}
```

è¿”å›ä½œä¸šè¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬å…³è”çš„ review è¯„è®ºã€‚

#### 4. é‡è¯•å¤±è´¥ä½œä¸š
```bash
POST /api/admin/jobs/{job_id}/retry
```

é‡æ–°å…¥é˜Ÿå¤±è´¥çš„ä½œä¸šã€‚åªèƒ½é‡è¯•çŠ¶æ€ä¸º `failed` æˆ– `dead_letter` çš„ä½œä¸šã€‚

#### 5. è·å–å¤±è´¥ä½œä¸šåˆ—è¡¨
```bash
GET /api/admin/failed-jobs?limit=50
```

è¿”å›æ‰€æœ‰å¤±è´¥å’Œæ­»ä¿¡é˜Ÿåˆ—çš„ä½œä¸šã€‚

#### 6. åˆ é™¤ä½œä¸š
```bash
DELETE /api/admin/jobs/{job_id}
```

âš ï¸ **è­¦å‘Š**: åˆ é™¤ä½œä¸šä¼šæ°¸ä¹…ç§»é™¤æ•°æ®åº“è®°å½•ï¼Œè¯·è°¨æ…ä½¿ç”¨ã€‚

## ä½¿ç”¨ç¤ºä¾‹

### æŸ¥çœ‹æ‰€æœ‰æ’é˜Ÿä¸­çš„ä½œä¸š

```bash
curl http://localhost:8000/api/admin/jobs?status=queued
```

### é‡è¯•å¤±è´¥çš„ä½œä¸š

```bash
curl -X POST http://localhost:8000/api/admin/jobs/123/retry
```

### è·å–ç»Ÿè®¡ä¿¡æ¯

```bash
curl http://localhost:8000/api/admin/stats | python3 -m json.tool
```

### æŸ¥çœ‹å¤±è´¥ä½œä¸š

```bash
curl http://localhost:8000/api/admin/failed-jobs
```

## çŠ¶æ€è¯´æ˜

### ä½œä¸šçŠ¶æ€

- **queued**: å·²å…¥é˜Ÿï¼Œç­‰å¾…å¤„ç†
- **processing**: æ­£åœ¨å¤„ç†ä¸­
- **completed**: å¤„ç†å®Œæˆ
- **failed**: å¤„ç†å¤±è´¥ï¼ˆå¯ä»¥é‡è¯•ï¼‰
- **dead_letter**: è¶…è¿‡æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œç§»è‡³æ­»ä¿¡é˜Ÿåˆ—

### çŠ¶æ€é¢œè‰²

- ğŸŸ  **Queued**: æ©™è‰²
- ğŸ”µ **Processing**: è“è‰²
- ğŸŸ¢ **Completed**: ç»¿è‰²
- ğŸ”´ **Failed**: çº¢è‰²
- ğŸŸ£ **Dead Letter**: ç´«è‰²

## æ“ä½œæŒ‡å—

### é‡è¯•å¤±è´¥ä½œä¸š

1. åœ¨ä»ªè¡¨æ¿ä¸­æ‰¾åˆ°çŠ¶æ€ä¸º `failed` æˆ– `dead_letter` çš„ä½œä¸š
2. ç‚¹å‡» "Retry" æŒ‰é’®
3. ç¡®è®¤æ“ä½œ
4. ä½œä¸šä¼šé‡æ–°å…¥é˜Ÿå¹¶å¤„ç†

### æŸ¥çœ‹ä½œä¸šè¯¦æƒ…

1. ç‚¹å‡»ä½œä¸šè¡Œçš„ "View" æŒ‰é’®
2. æŸ¥çœ‹ JSON æ ¼å¼çš„è¯¦ç»†ä¿¡æ¯
3. åŒ…æ‹¬æ‰€æœ‰æ—¶é—´æˆ³å’Œå…³è”çš„ review è¯„è®º

### ç›‘æ§é˜Ÿåˆ—å¥åº·

1. æŸ¥çœ‹ç»Ÿè®¡é¢æ¿ä¸­çš„ "Queue Length"
2. å¦‚æœæŒç»­å¢é•¿ï¼Œå¯èƒ½ worker æ²¡æœ‰è¿è¡Œ
3. æ£€æŸ¥ "Processing" æ•°é‡ï¼Œå¦‚æœé•¿æ—¶é—´ä¸å˜ï¼Œå¯èƒ½ worker å¡ä½

## æ•…éšœæ’é™¤

### ä»ªè¡¨æ¿ä¸æ˜¾ç¤ºæ•°æ®

- æ£€æŸ¥åº”ç”¨æ˜¯å¦è¿è¡Œï¼š`curl http://localhost:8000/health`
- æ£€æŸ¥æ•°æ®åº“è¿æ¥
- æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯

### é‡è¯•æŒ‰é’®ä¸å¯ç”¨

- åªæœ‰ `failed` å’Œ `dead_letter` çŠ¶æ€çš„ä½œä¸šå¯ä»¥é‡è¯•
- æ£€æŸ¥ä½œä¸šçŠ¶æ€æ˜¯å¦æ­£ç¡®

### æ•°æ®ä¸æ›´æ–°

- ä»ªè¡¨æ¿æ¯ 10 ç§’è‡ªåŠ¨åˆ·æ–°
- å¯ä»¥æ‰‹åŠ¨ç‚¹å‡» "Refresh" æŒ‰é’®
- æ£€æŸ¥ç½‘ç»œè¿æ¥

## å®‰å…¨æ³¨æ„äº‹é¡¹

âš ï¸ **ç”Ÿäº§ç¯å¢ƒå»ºè®®**:

1. æ·»åŠ è®¤è¯/æˆæƒæœºåˆ¶
2. é™åˆ¶è®¿é—® IP
3. ä½¿ç”¨ HTTPS
4. æ·»åŠ é€Ÿç‡é™åˆ¶

å½“å‰å®ç°ä¸ºå¼€å‘æ¨¡å¼ï¼Œæ‰€æœ‰ç«¯ç‚¹å…¬å¼€è®¿é—®ã€‚

## æœªæ¥å¢å¼º

- [ ] æ·»åŠ è®¤è¯ï¼ˆJWT/Basic Authï¼‰
- [ ] æ‰¹é‡æ“ä½œï¼ˆæ‰¹é‡é‡è¯•ã€åˆ é™¤ï¼‰
- [ ] é«˜çº§è¿‡æ»¤å’Œæœç´¢
- [ ] å¯¼å‡ºæ•°æ®ï¼ˆCSV/JSONï¼‰
- [ ] å›¾è¡¨å’Œå¯è§†åŒ–
- [ ] å®æ—¶ WebSocket æ›´æ–°
- [ ] ä½œä¸šå†å²è®°å½•

